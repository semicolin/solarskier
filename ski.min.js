var Ski=function(){var r=function(k,c){return"hsla("+k+",100%,50%,"+c+")"},M=function(){var k=new Audio("sfx/5A.ogg"),c=new Audio("sfx/5Ab.ogg"),s=new Audio("sfx/5G.ogg"),g=new Audio("sfx/5Gb.ogg"),f=new Audio("sfx/5F.ogg"),e=new Audio("sfx/5E.ogg"),h=new Audio("sfx/5Eb.ogg"),m=new Audio("sfx/5D.ogg"),p=new Audio("sfx/5Db.ogg"),a=new Audio("sfx/5C.ogg"),t=new Audio("sfx/4B.ogg"),d=new Audio("sfx/4Bb.ogg"),b=new Audio("sfx/4A.ogg"),l=new Audio("sfx/4Ab.ogg"),q=new Audio("sfx/4G.ogg"),n=new Audio("sfx/4Gb.ogg"), u=new Audio("sfx/4F.ogg"),v=new Audio("sfx/4E.ogg"),w=new Audio("sfx/4Eb.ogg"),r=new Audio("sfx/4D.ogg"),C=new Audio("sfx/4Db.ogg"),x=new Audio("sfx/4C.ogg"),D=new Audio("sfx/3B.ogg"),H=new Audio("sfx/3Bb.ogg"),y=new Audio("sfx/3A.ogg"),F=[s,m,t,q,r,D],I=[s,e,a,q,v,x],K=[k,f,a,b,u,x],y=[e,a,b,v,x,y],E=[{name:"First Song",progression:[I,F,I,K,F,y,F],timing:[8,8,4,8,4,8,8]},{name:"Rising Fifths",progression:[[c,e,t,l,v,D],[k,e,p,b,v,C],[k,g,m,b,n,r],F,I,K,[f,m,d,u,r,H],[s,h,d,q,w,H],[c,h,a,l,w,x],[c, f,p,l,u,C],[g,p,d,n,C,H]],timing:[6,6,6,6,6,6,6,6,6,6,6]},{name:"Minor Setback",progression:[y,[k,f,m,b,u,r],y,[q,e,t,q,v,D],y],timing:[8,8,8,4,4]}],J=!0,z=0,A,B,G;toggle=function(){J=!J};changeTune=function(){z=(z+1)%E.length;B=A=0;G=120};draw=function(a,b,d){0<G&&(G-=1,a.textAlign="center",a.textBaseline="bottom",a.fillStyle="gray",a.font=Math.floor(b/40)+"px Alegreya Sans SC",a.fillText(E[z].name,b/2,d-10))};return{init:function(){B=A=0;return this},playNote:function(a){B+=1;B>E[z].timing[A]&& (B=0,A=(A+1)%E[z].progression.length);if(J){var b=E[z].progression[A];a=b[Math.floor(b.length*a/100)];a.currentTime=0;a.play()}},toggle:toggle,changeTune:changeTune,draw:draw}}(),Q=function(){var k,c,s,g,f,e,h,m,p,a,t,d,b,l,q,n,u=function(){k.width=window.innerWidth;k.height=window.innerHeight-5;f=k.width;e=k.height},v=function(){g={};a=p=m=h=0;n=M.init();b=N.init(f,e);l=O.init(b,n,f,e);q=P.Planets.init(b,l,f,e);s=setInterval(w.bind(this),1E3/60);d=t=!1},w=function(){if(!d){var u=-1*b.getSpeed()* Math.sin(b.getBearing()),t=1-(b.getY()-h)/e,t=Math.max(0,3*t-1);a=Math.max(-0.025,u*t-m);p+=5E-4}m+=a;m=Math.max(m,p);h-=m;c.setTransform(1,0,0,1,0,-Math.floor(h));c.clearRect(0,h,f,e);d||(q.update(h),b.update(g,h)||(d=!0,a=-0.05,p=-15,l.saveHighscore()));q.clip(h,h+e,d);b.clip(h,h+e,d);q.draw(c);b.draw(c,h+e);c.setTransform(1,0,0,1,0,0);n.draw(c,f,e);l.draw(c,d);0<h&&clearInterval(s)},L=function(a){g[a.which]=!0;(t||d)&&g[13]&&(clearInterval(s),u(),v());g[83]&&n.toggle();g[84]&&n.changeTune()},C= function(a){g[a.which]=!1},x=function(a){a.preventDefault();t||d?(u(),v()):parseInt(a.changedTouches[0].clientX,10)<f/2?g[37]=!0:g[39]=!0},D=function(a){a.preventDefault();g[37]=!1;g[39]=!1};return{init:function(a){k=a;c=k.getContext("2d");g={};document.onkeydown=L;document.onkeyup=C;k.addEventListener("touchstart",x);k.addEventListener("touchend",D);u();a=Math.floor(f/10);var b=Math.floor(f/40);c.font=a+"px Cinzel Decorative";c.textAlign="center";c.textBaseline="middle";c.fillStyle=c.createLinearGradient(0, e/2-a/2,0,e/2+a/2);c.fillStyle.addColorStop(0,r(190,1));c.fillStyle.addColorStop(1,r(300,1));c.fillText("Solar Skier",f/2,e/2);c.font=b+"px Alegreya Sans SC";c.fillStyle="black";c.fillText("left + right to turn",f/2,e/2+0.75*a);c.fillText("press enter to begin",f/2,e/2+0.75*a+b);c.fillStyle="hsla(245,10%,50%,0.5)";c.beginPath();c.arc(0.677*f,e/2-0.8*a,a/5,0,2*Math.PI);c.fill();c.textBaseline="bottom";c.fillStyle="gray";c.font=b+"px Alegreya Sans SC";c.textAlign="left";c.fillText("t: change tune", 10,e-10-b);c.fillText("s: mute sound",10,e-10);t=!0}}}(),O=function(){var k=0,c,s,g,f,e,h,m=function(a){a=a.toString();for(var c="",d=1;d<=a.length;d++)c=a[a.length-d]+c,0===d%3&&(c=" "+c);return c},p=function(){if(document.cookie)for(var a=document.cookie.split(";"),c=0;c<a.length;c++){var d=a[c].split("=");if("solarskierhighscore"===d[0])return k=d[1],!0}return!1};return{init:function(a,m,d,b){e=a;h=m;c=d;s=b;g=f=0;p();return this},draw:function(a,h){var d=Math.max(16,Math.floor(c/80)),b=Math.max(32, Math.floor(c/40));h&&(0.7>f&&(f+=0.005),a.fillStyle="hsla(0,0%,100%,"+f+")",a.fillRect(0,0,c,s));a.textAlign="left";a.textBaseline="top";var l=20;a.fillStyle=r(e.getHue(),1);a.font=b+"px sans-serif";a.fillText(Math.floor(10*e.getSpeed()),20,l);l+=0.9*b;a.font=d+"px Alegreya Sans SC";a.fillText("speed",20,l);l+=d+0.2*b;a.fillStyle=r(245-(e.getHue()-245),1);a.font=b+"px sans-serif";a.fillText(Math.floor(10*e.getAvgSpeed()),20,l);a.font=d+"px Alegreya Sans SC";a.fillText("avg",20,l+0.9*b);a.textAlign= "right";a.textBaseline="top";l=20;a.fillStyle=r(245-(e.getHue()-245),1);a.font=b+"px sans-serif";a.fillText(m(k),c-20,l);l+=0.9*b;a.font=d+"px Alegreya Sans SC";a.fillText("best",c-20,l);l+=d+0.2*b;a.fillStyle=r(e.getHue(),1);a.font=b+"px sans-serif";a.fillText(m(g),c-20,l);l+=0.9*b;a.font=d+"px Alegreya Sans SC";a.fillText("score",c-20,l);h&&(b=Math.floor(c/15),d=Math.floor(c/40),a.font=b+"px Alegreya Sans SC",a.textAlign="center",a.textBaseline="middle",g===k&&0<k?(a.fillStyle=a.createLinearGradient(0, s/2-b/2,0,s/2+b/2),a.fillStyle.addColorStop(0,r(190,1)),a.fillStyle.addColorStop(1,r(300,1)),a.fillText("New High Score!",c/2,s/2),a.fillStyle=a.createLinearGradient(0,s/2-b-b/2,0,s/2-b+b/2),a.fillStyle.addColorStop(0,r(300,1)),a.fillStyle.addColorStop(1,r(190,1)),a.font=b+"px sans-serif",a.fillText(m(g),c/2,s/2-b)):(a.fillStyle="black",a.fillText("Game Over",c/2,s/2)),a.font=d+"px Alegreya Sans SC",a.fillStyle="black",a.fillText("press enter to play again",c/2,s/2+b))},saveHighscore:function(){if(g> k){k=g;var a=new Date;a.setTime(a.getTime()+31536E6);document.cookie="solarskierhighscore="+k+";expires="+a.toGMTString()}},loadHighscore:p,addPoints:function(a){g+=a;h.playNote(a)},removePoints:function(a){g-=a}}}(),N=function(){var k=Math.PI/36,c,s,g,f,e,h,m,p,a,t,d,b,l,q,n;return{init:function(u,k){c=u;s=k;g=Math.floor(u/3);f=k-1;e=-Math.PI/2;h=0;m=[];a=p=0;t=4;d=245;b=1;q=l=0;n=!1;return this},update:function(u,p){u[37]&&!n&&1!==h?(h=-1,q+=b,q=Math.min(q,200),b-=4E-4*q,e=(e-k)%(2*Math.PI),190< d&&(d-=5)):u[39]&&!n&&-1!==h?(h=1,q+=b,q=Math.min(q,200),b-=4E-4*q,e=(e+k)%(2*Math.PI),300>d&&(d+=5)):(q-=15,0>=q&&(h=q=0),b+=0.02,245<d?d-=5:245>d&&(d+=5));t=4+0.12*q;b=Math.max(b,1);var w=1/(m.length||1);l=b*w+l*(1-w);g+=b*Math.cos(e);f+=b*Math.sin(e);m.push({x:g,y:f,size:t,color:r(d,1)});a+=1;return n||0>g||f<p||g>c||f>s+p?!1:!0},clip:function(b,d,c){if(c){for(;0<a&&m[a-1].y<b-20;)a-=1;p=Math.max(0,a-(200+d-b))}else for(;p<m.length-1&&m[p].y>d+20;)p+=1},draw:function(b,d){b.lineCap="round";for(var c= m[p].x,e=m[p].y,f,l=p+1;l<a;l++)f=m[l],f.y<d&&(b.lineWidth=f.size,b.strokeStyle=f.color,b.beginPath(),b.moveTo(c,e),b.lineTo(f.x,f.y),b.stroke()),c=f.x,e=f.y},setObstructed:function(a){n=a},getHue:function(){return d},getX:function(){return g},getY:function(){return f},getBearing:function(){return e},getSpeed:function(){return b},getAvgSpeed:function(){return l}}}(),P=function(){var k=r(190,0.8),c=r(300,0.8),s,g,f,e,h,m,p;return{Planets:function(){var a,t=function(a){var b=81;0.1>Math.random()&&(b= 100);f.push({x:Math.floor(Math.random()*s),y:a,r:Math.floor(Math.random()*(b-10)+10)})};return{init:function(d,b,c,q){m=d;p=b;s=c;g=q;a=64E3/s;f=[];for(d=g-300;-100<d;d-=a)t(d);e=0;h=f.length;return this},update:function(d){for(a-=0.003;;){var b=f[f.length-1].y-a;if(b<d-100)break;else t(b),h+=1}d=m.getX();var b=m.getY(),c=m.getBearing()+2*Math.PI;m.setObstructed(!1);for(var g=e;g<h;g++){var n=f[g],k=d-n.x,s=b-n.y,r=n.r+100,k=k*k+s*s;k<n.r*n.r?(m.setObstructed(!0),n.hit=!0,n.slalom&&(p.removePoints(n.r), n.slalom=!1)):!n.hit&&!n.slalom&&k<r*r&&(r=Math.atan2(n.y-b,n.x-d),r=(c-r+2*Math.PI)%(2*Math.PI),Math.PI/4<r&&r<3*Math.PI/4?(n.slalom=-1,p.addPoints(n.r)):5*Math.PI/4<r&&r<7*Math.PI/4&&(n.slalom=1,p.addPoints(n.r)))}},clip:function(a,b,c){if(c){for(;0<e&&f[e-1].y<b+100;)e-=1;for(;0<h&&f[h-1].y<a-100;)h-=1}else for(;f[e].y>b+100;)e+=1},draw:function(a){for(var b,g=e;g<h;g++)b=f[g],a.fillStyle=-1===b.slalom?k:1===b.slalom?c:"hsla(245,10%,50%,0.5)",a.beginPath(),a.arc(b.x,b.y,b.r,0,2*Math.PI),a.fill(), b.slalom&&(a.fillStyle="white",a.font=Math.floor(0.8*b.r)+"px sans-serif",a.textAlign="center",a.textBaseline="middle",a.fillText(b.r,b.x,b.y))}}}()}}();Q.init(document.getElementById("game"))};